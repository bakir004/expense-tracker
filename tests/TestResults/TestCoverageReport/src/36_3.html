<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/bax/Desktop/kodecta-academy/expense-tracker/src/ExpenseTrackerAPI.Infrastructure/Persistence/Configurations/TransactionConfiguration.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Metadata.Builders;
using ExpenseTrackerAPI.Domain.Entities;

namespace ExpenseTrackerAPI.Infrastructure.Persistence.Configurations;

public class TransactionConfiguration : IEntityTypeConfiguration&lt;Transaction&gt;
{
    public void Configure(EntityTypeBuilder&lt;Transaction&gt; builder)
    {
        builder.ToTable(&quot;Transactions&quot;);

        builder.HasKey(t =&gt; t.Id);

        builder.Property(t =&gt; t.Id)
            .HasColumnName(&quot;id&quot;)
            .ValueGeneratedOnAdd();

        builder.Property(t =&gt; t.UserId)
            .HasColumnName(&quot;user_id&quot;)
            .IsRequired();

        builder.Property(t =&gt; t.TransactionType)
            .HasColumnName(&quot;transaction_type&quot;)
            .IsRequired()
            .HasConversion&lt;string&gt;()
            .HasMaxLength(20);

        builder.Property(t =&gt; t.Amount)
            .HasColumnName(&quot;amount&quot;)
            .IsRequired()
            .HasPrecision(12, 2);

        builder.Property(t =&gt; t.SignedAmount)
            .HasColumnName(&quot;signed_amount&quot;)
            .IsRequired()
            .HasPrecision(12, 2);

        builder.Property(t =&gt; t.Date)
            .HasColumnName(&quot;date&quot;)
            .IsRequired()
            .HasColumnType(&quot;date&quot;);

        builder.Property(t =&gt; t.Subject)
            .HasColumnName(&quot;subject&quot;)
            .IsRequired()
            .HasMaxLength(255);

        builder.Property(t =&gt; t.Notes)
            .HasColumnName(&quot;notes&quot;)
            .HasColumnType(&quot;text&quot;);

        builder.Property(t =&gt; t.PaymentMethod)
            .HasColumnName(&quot;payment_method&quot;)
            .IsRequired()
            .HasConversion&lt;string&gt;()
            .HasMaxLength(20);

        builder.Property(t =&gt; t.CumulativeDelta)
            .HasColumnName(&quot;cumulative_delta&quot;)
            .IsRequired()
            .HasPrecision(12, 2);

        builder.Property(t =&gt; t.CategoryId)
            .HasColumnName(&quot;category_id&quot;);

        builder.Property(t =&gt; t.TransactionGroupId)
            .HasColumnName(&quot;transaction_group_id&quot;);

        builder.Property(t =&gt; t.CreatedAt)
            .HasColumnName(&quot;created_at&quot;)
            .HasColumnType(&quot;timestamp with time zone&quot;)
            .HasDefaultValueSql(&quot;CURRENT_TIMESTAMP&quot;);

        builder.Property(t =&gt; t.UpdatedAt)
            .HasColumnName(&quot;updated_at&quot;)
            .HasColumnType(&quot;timestamp with time zone&quot;)
            .HasDefaultValueSql(&quot;CURRENT_TIMESTAMP&quot;);

        // Indexes matching the database schema
        builder.HasIndex(t =&gt; new { t.UserId, t.Date, t.Id })
            .HasDatabaseName(&quot;idx_transaction_user_date&quot;)
            .IsDescending(false, true, true);

        builder.HasIndex(t =&gt; new { t.UserId, t.TransactionType })
            .HasDatabaseName(&quot;idx_transaction_type&quot;);

        builder.HasIndex(t =&gt; t.TransactionGroupId)
            .HasDatabaseName(&quot;idx_transaction_group&quot;);

        // Foreign key relationships
        builder.HasOne&lt;User&gt;()
            .WithMany()
            .HasForeignKey(t =&gt; t.UserId)
            .OnDelete(DeleteBehavior.Cascade);

        builder.HasOne&lt;Category&gt;()
            .WithMany()
            .HasForeignKey(t =&gt; t.CategoryId)
            .OnDelete(DeleteBehavior.Restrict);

        builder.HasOne&lt;TransactionGroup&gt;()
            .WithMany()
            .HasForeignKey(t =&gt; t.TransactionGroupId)
            .OnDelete(DeleteBehavior.SetNull);
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[10,5,10,6,1],[11,9,11,41,1],[13,9,13,35,1],[15,9,17,36,1],[19,9,21,27,1],[23,9,27,31,1],[29,9,32,34,1],[34,9,37,34,1],[39,9,42,36,1],[44,9,47,32,1],[49,9,51,36,1],[53,9,57,31,1],[59,9,62,34,1],[64,9,65,43,1],[67,9,68,52,1],[70,9,73,54,1],[75,9,78,54,1],[81,9,83,46,1],[85,9,86,54,1],[88,9,89,55,1],[92,9,95,47,1],[97,9,100,48,1],[102,9,105,47,1],[106,5,106,6,1]]);
    </script>
  </body>
</html>