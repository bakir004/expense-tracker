<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/bax/Desktop/kodecta-academy/expense-tracker/src/ExpenseTrackerAPI.Contracts/Transactions/TransactionRequestParser.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ErrorOr;
using ExpenseTrackerAPI.Domain.Entities;
using ExpenseTrackerAPI.Domain.Errors;

namespace ExpenseTrackerAPI.Contracts.Transactions;

/// &lt;summary&gt;
/// Utility class for parsing and validating transaction request string values to enums.
/// &lt;/summary&gt;
public static class TransactionRequestParser
{
    private static readonly Dictionary&lt;string, TransactionType&gt; TransactionTypeMap = new(StringComparer.OrdinalIgnoreCase)
    {
        { &quot;EXPENSE&quot;, TransactionType.EXPENSE },
        { &quot;INCOME&quot;, TransactionType.INCOME }
    };

    private static readonly Dictionary&lt;string, PaymentMethod&gt; PaymentMethodMap = new(StringComparer.OrdinalIgnoreCase)
    {
        { &quot;CASH&quot;, PaymentMethod.CASH },
        { &quot;DEBIT_CARD&quot;, PaymentMethod.DEBIT_CARD },
        { &quot;CREDIT_CARD&quot;, PaymentMethod.CREDIT_CARD },
        { &quot;BANK_TRANSFER&quot;, PaymentMethod.BANK_TRANSFER },
        { &quot;MOBILE_PAYMENT&quot;, PaymentMethod.MOBILE_PAYMENT },
        { &quot;PAYPAL&quot;, PaymentMethod.PAYPAL },
        { &quot;CRYPTO&quot;, PaymentMethod.CRYPTO },
        { &quot;OTHER&quot;, PaymentMethod.OTHER }
    };

    /// &lt;summary&gt;
    /// Parses a string value to TransactionType enum.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;value&quot;&gt;The string value to parse (e.g., &quot;EXPENSE&quot; or &quot;INCOME&quot;)&lt;/param&gt;
    /// &lt;returns&gt;The parsed TransactionType or an error&lt;/returns&gt;
    public static ErrorOr&lt;TransactionType&gt; ParseTransactionType(string? value)
    {
        if (string.IsNullOrWhiteSpace(value))
        {
            return TransactionErrors.TransactionTypeRequired;
        }

        var trimmedValue = value.Trim();
        if (TransactionTypeMap.TryGetValue(trimmedValue, out var transactionType))
        {
            return transactionType;
        }

        return TransactionErrors.InvalidTransactionType;
    }

    /// &lt;summary&gt;
    /// Parses a string value to PaymentMethod enum.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;value&quot;&gt;The string value to parse (e.g., &quot;CASH&quot;, &quot;CREDIT_CARD&quot;)&lt;/param&gt;
    /// &lt;returns&gt;The parsed PaymentMethod or an error&lt;/returns&gt;
    public static ErrorOr&lt;PaymentMethod&gt; ParsePaymentMethod(string? value)
    {
        if (string.IsNullOrWhiteSpace(value))
        {
            return TransactionErrors.PaymentMethodRequired;
        }

        var trimmedValue = value.Trim();
        if (PaymentMethodMap.TryGetValue(trimmedValue, out var paymentMethod))
        {
            return paymentMethod;
        }

        return TransactionErrors.InvalidPaymentMethod;
    }

    /// &lt;summary&gt;
    /// Parses and validates a CreateTransactionRequest, converting string values to enums.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;request&quot;&gt;The request to parse&lt;/param&gt;
    /// &lt;returns&gt;A tuple of (TransactionType, PaymentMethod) or validation errors&lt;/returns&gt;
    public static ErrorOr&lt;(TransactionType TransactionType, PaymentMethod PaymentMethod)&gt; ParseCreateRequest(
        CreateTransactionRequest request)
    {
        var errors = new List&lt;Error&gt;();

        var transactionTypeResult = ParseTransactionType(request.TransactionType);
        if (transactionTypeResult.IsError)
        {
            errors.AddRange(transactionTypeResult.Errors);
        }

        var paymentMethodResult = ParsePaymentMethod(request.PaymentMethod);
        if (paymentMethodResult.IsError)
        {
            errors.AddRange(paymentMethodResult.Errors);
        }

        if (errors.Count &gt; 0)
        {
            return errors;
        }

        return (transactionTypeResult.Value, paymentMethodResult.Value);
    }

    /// &lt;summary&gt;
    /// Parses and validates an UpdateTransactionRequest, converting string values to enums.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;request&quot;&gt;The request to parse&lt;/param&gt;
    /// &lt;returns&gt;A tuple of (TransactionType, PaymentMethod) or validation errors&lt;/returns&gt;
    public static ErrorOr&lt;(TransactionType TransactionType, PaymentMethod PaymentMethod)&gt; ParseUpdateRequest(
        UpdateTransactionRequest request)
    {
        var errors = new List&lt;Error&gt;();

        var transactionTypeResult = ParseTransactionType(request.TransactionType);
        if (transactionTypeResult.IsError)
        {
            errors.AddRange(transactionTypeResult.Errors);
        }

        var paymentMethodResult = ParsePaymentMethod(request.PaymentMethod);
        if (paymentMethodResult.IsError)
        {
            errors.AddRange(paymentMethodResult.Errors);
        }

        if (errors.Count &gt; 0)
        {
            return errors;
        }

        return (transactionTypeResult.Value, paymentMethodResult.Value);
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[12,5,16,7,1],[18,5,28,7,1],[36,5,36,6,1],[37,9,37,46,1],[38,9,38,10,0],[39,13,39,62,0],[42,9,42,41,1],[43,9,43,83,1],[44,9,44,10,1],[45,13,45,36,1],[48,9,48,57,1],[49,5,49,6,1],[57,5,57,6,1],[58,9,58,46,1],[59,9,59,10,0],[60,13,60,60,0],[63,9,63,41,1],[64,9,64,79,1],[65,9,65,10,1],[66,13,66,34,1],[69,9,69,55,1],[70,5,70,6,1],[79,5,79,6,1],[80,9,80,40,1],[82,9,82,83,1],[83,9,83,43,1],[84,9,84,10,1],[85,13,85,59,1],[86,9,86,10,1],[88,9,88,77,1],[89,9,89,41,1],[90,9,90,10,1],[91,13,91,57,1],[92,9,92,10,1],[94,9,94,30,1],[95,9,95,10,1],[96,13,96,27,1],[99,9,99,73,1],[100,5,100,6,1],[109,5,109,6,1],[110,9,110,40,1],[112,9,112,83,1],[113,9,113,43,1],[114,9,114,10,1],[115,13,115,59,1],[116,9,116,10,1],[118,9,118,77,1],[119,9,119,41,1],[120,9,120,10,0],[121,13,121,57,0],[122,9,122,10,0],[124,9,124,30,1],[125,9,125,10,1],[126,13,126,27,1],[129,9,129,73,1],[130,5,130,6,1]]);
    </script>
  </body>
</html>