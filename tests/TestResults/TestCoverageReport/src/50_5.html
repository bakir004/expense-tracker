<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/bax/Desktop/kodecta-academy/expense-tracker/src/ExpenseTrackerAPI.WebApi/Controllers/V1/TransactionGroupController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Microsoft.AspNetCore.Mvc;
using ExpenseTrackerAPI.Application.TransactionGroups.Interfaces.Application;
using ExpenseTrackerAPI.Contracts.TransactionGroups;
using Microsoft.AspNetCore.Authorization;
using Asp.Versioning;
using ExpenseTrackerAPI.Domain.Errors;

namespace ExpenseTrackerAPI.WebApi.Controllers.V1;

/// &lt;summary&gt;
/// Transaction group management endpoints for API version 1.0.
/// &lt;/summary&gt;
[ApiController]
[Route(&quot;api/v{version:apiVersion}/transaction-groups&quot;)]
[ApiVersion(&quot;1.0&quot;)]
[Authorize]
public class TransactionGroupController : ApiControllerBase
{
    private readonly ITransactionGroupService _transactionGroupService;
    private readonly ILogger&lt;TransactionGroupController&gt; _logger;

    /// &lt;summary&gt;
    /// Initializes a new instance of the TransactionGroupController class.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;transactionGroupService&quot;&gt;Transaction group service&lt;/param&gt;
    /// &lt;param name=&quot;logger&quot;&gt;Logger instance&lt;/param&gt;
    public TransactionGroupController(
        ITransactionGroupService transactionGroupService,
        ILogger&lt;TransactionGroupController&gt; logger)
    {
        _transactionGroupService = transactionGroupService ?? throw new ArgumentNullException(nameof(transactionGroupService));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// &lt;summary&gt;
    /// Get all transaction groups for the authenticated user.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;cancellationToken&quot;&gt;Cancellation token&lt;/param&gt;
    /// &lt;returns&gt;List of transaction groups belonging to the user&lt;/returns&gt;
    /// &lt;response code=&quot;200&quot;&gt;Transaction groups retrieved successfully&lt;/response&gt;
    /// &lt;response code=&quot;401&quot;&gt;User not authenticated&lt;/response&gt;
    [HttpGet]
    [ProducesResponseType(typeof(IEnumerable&lt;TransactionGroupResponse&gt;), StatusCodes.Status200OK)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status401Unauthorized)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status500InternalServerError)]
    public async Task&lt;IActionResult&gt; GetAll(CancellationToken cancellationToken = default)
    {
        var unauthorizedResult = CheckUserContext();
        if (unauthorizedResult != null) return unauthorizedResult;

        var userId = GetRequiredUserId();

        var result = await _transactionGroupService.GetByUserIdAsync(userId, cancellationToken);

        if (result.IsError)
        {
            _logger.LogWarning(&quot;Failed to get transaction groups for user {UserId}: {Errors}&quot;,
                userId, string.Join(&quot;, &quot;, result.Errors.Select(e =&gt; e.Description)));
            return Problem(result.Errors);
        }

        var transactionGroups = result.Value;
        return Ok(transactionGroups.ToResponses());
    }

    /// &lt;summary&gt;
    /// Get a specific transaction group by ID.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;Transaction group ID&lt;/param&gt;
    /// &lt;param name=&quot;cancellationToken&quot;&gt;Cancellation token&lt;/param&gt;
    /// &lt;returns&gt;Transaction group details&lt;/returns&gt;
    /// &lt;response code=&quot;200&quot;&gt;Transaction group retrieved successfully&lt;/response&gt;
    /// &lt;response code=&quot;401&quot;&gt;User not authenticated&lt;/response&gt;
    /// &lt;response code=&quot;404&quot;&gt;Transaction group not found&lt;/response&gt;
    [HttpGet(&quot;{id:int}&quot;)]
    [ProducesResponseType(typeof(TransactionGroupResponse), StatusCodes.Status200OK)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status401Unauthorized)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status404NotFound)]
    public async Task&lt;IActionResult&gt; GetById(int id, CancellationToken cancellationToken = default)
    {
        if (id &lt;= 0)
        {
            _logger.LogWarning(&quot;Invalid transaction group ID {TransactionGroupId} provided by user {UserId}&quot;, id, GetUserId());
            return Problem(TransactionGroupErrors.InvalidTransactionGroupId);
        }

        var unauthorizedResult = CheckUserContext();
        if (unauthorizedResult != null) return unauthorizedResult;

        var userId = GetRequiredUserId();

        var result = await _transactionGroupService.GetByIdAsync(id, userId, cancellationToken);

        if (result.IsError)
        {
            _logger.LogWarning(&quot;Failed to get transaction group {TransactionGroupId} for user {UserId}: {Errors}&quot;,
                id, userId, string.Join(&quot;, &quot;, result.Errors.Select(e =&gt; e.Description)));
            return Problem(result.Errors);
        }

        var transactionGroup = result.Value;
        return Ok(transactionGroup.ToResponse());
    }

    /// &lt;summary&gt;
    /// Create a new transaction group for the authenticated user.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;request&quot;&gt;Transaction group creation request&lt;/param&gt;
    /// &lt;param name=&quot;cancellationToken&quot;&gt;Cancellation token&lt;/param&gt;
    /// &lt;returns&gt;Created transaction group&lt;/returns&gt;
    /// &lt;response code=&quot;201&quot;&gt;Transaction group created successfully&lt;/response&gt;
    /// &lt;response code=&quot;400&quot;&gt;Invalid request data&lt;/response&gt;
    /// &lt;response code=&quot;401&quot;&gt;User not authenticated&lt;/response&gt;
    [HttpPost]
    [ProducesResponseType(typeof(TransactionGroupResponse), StatusCodes.Status201Created)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status400BadRequest)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status401Unauthorized)]
    public async Task&lt;IActionResult&gt; Create(
        [FromBody] CreateTransactionGroupRequest request,
        CancellationToken cancellationToken = default)
    {
        var unauthorizedResult = CheckUserContext();
        if (unauthorizedResult != null) return unauthorizedResult;

        var userId = GetRequiredUserId();

        var result = await _transactionGroupService.CreateAsync(
            userId: userId,
            name: request.Name,
            description: request.Description,
            cancellationToken: cancellationToken);

        if (result.IsError)
        {
            _logger.LogWarning(&quot;Failed to create transaction group for user {UserId}: {Errors}&quot;,
                userId, string.Join(&quot;, &quot;, result.Errors.Select(e =&gt; e.Description)));
            return Problem(result.Errors);
        }

        var transactionGroup = result.Value;
        return CreatedAtAction(
            nameof(GetById),
            new { id = transactionGroup.Id, version = &quot;1.0&quot; },
            transactionGroup.ToResponse());
    }

    /// &lt;summary&gt;
    /// Update an existing transaction group.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;Transaction group ID to update&lt;/param&gt;
    /// &lt;param name=&quot;request&quot;&gt;Transaction group update request&lt;/param&gt;
    /// &lt;param name=&quot;cancellationToken&quot;&gt;Cancellation token&lt;/param&gt;
    /// &lt;returns&gt;Updated transaction group&lt;/returns&gt;
    /// &lt;response code=&quot;200&quot;&gt;Transaction group updated successfully&lt;/response&gt;
    /// &lt;response code=&quot;400&quot;&gt;Invalid request data&lt;/response&gt;
    /// &lt;response code=&quot;401&quot;&gt;User not authenticated&lt;/response&gt;
    /// &lt;response code=&quot;404&quot;&gt;Transaction group not found&lt;/response&gt;
    [HttpPut(&quot;{id:int}&quot;)]
    [ProducesResponseType(typeof(TransactionGroupResponse), StatusCodes.Status200OK)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status400BadRequest)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status401Unauthorized)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status404NotFound)]
    public async Task&lt;IActionResult&gt; Update(
        int id,
        [FromBody] UpdateTransactionGroupRequest request,
        CancellationToken cancellationToken = default)
    {
        if (id &lt;= 0)
        {
            _logger.LogWarning(&quot;Invalid transaction group ID {TransactionGroupId} provided by user {UserId}&quot;, id, GetUserId());
            return Problem(TransactionGroupErrors.InvalidTransactionGroupId);
        }

        var unauthorizedResult = CheckUserContext();
        if (unauthorizedResult != null) return unauthorizedResult;

        var userId = GetRequiredUserId();

        var result = await _transactionGroupService.UpdateAsync(
            id: id,
            userId: userId,
            name: request.Name,
            description: request.Description,
            cancellationToken: cancellationToken);

        if (result.IsError)
        {
            _logger.LogWarning(&quot;Failed to update transaction group {TransactionGroupId} for user {UserId}: {Errors}&quot;,
                id, userId, string.Join(&quot;, &quot;, result.Errors.Select(e =&gt; e.Description)));
            return Problem(result.Errors);
        }

        var transactionGroup = result.Value;
        return Ok(transactionGroup.ToResponse());
    }

    /// &lt;summary&gt;
    /// Delete a transaction group.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;id&quot;&gt;Transaction group ID to delete&lt;/param&gt;
    /// &lt;param name=&quot;cancellationToken&quot;&gt;Cancellation token&lt;/param&gt;
    /// &lt;returns&gt;No content on success&lt;/returns&gt;
    /// &lt;response code=&quot;204&quot;&gt;Transaction group deleted successfully&lt;/response&gt;
    /// &lt;response code=&quot;401&quot;&gt;User not authenticated&lt;/response&gt;
    /// &lt;response code=&quot;404&quot;&gt;Transaction group not found&lt;/response&gt;
    [HttpDelete(&quot;{id:int}&quot;)]
    [ProducesResponseType(StatusCodes.Status204NoContent)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status401Unauthorized)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status404NotFound)]
    public async Task&lt;IActionResult&gt; Delete(int id, CancellationToken cancellationToken = default)
    {
        if (id &lt;= 0)
        {
            _logger.LogWarning(&quot;Invalid transaction group ID {TransactionGroupId} provided by user {UserId}&quot;, id, GetUserId());
            return Problem(TransactionGroupErrors.InvalidTransactionGroupId);
        }

        var unauthorizedResult = CheckUserContext();
        if (unauthorizedResult != null) return unauthorizedResult;

        var userId = GetRequiredUserId();

        var result = await _transactionGroupService.DeleteAsync(id, userId, cancellationToken);

        if (result.IsError)
        {
            _logger.LogWarning(&quot;Failed to delete transaction group {TransactionGroupId} for user {UserId}: {Errors}&quot;,
                id, userId, string.Join(&quot;, &quot;, result.Errors.Select(e =&gt; e.Description)));
            return Problem(result.Errors);
        }

        return NoContent();
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[27,5,29,52,1],[30,5,30,6,1],[31,9,31,128,1],[32,9,32,77,1],[33,5,33,6,1],[47,5,47,6,1],[48,9,48,53,1],[49,9,49,40,1],[49,41,49,67,0],[51,9,51,42,1],[53,9,53,97,1],[55,9,55,28,1],[56,9,56,10,0],[57,13,58,69,0],[58,69,58,82,0],[58,82,58,86,0],[59,13,59,43,0],[62,9,62,46,1],[63,9,63,52,1],[64,5,64,6,1],[80,5,80,6,1],[81,9,81,21,1],[82,9,82,10,1],[83,13,83,128,1],[84,13,84,78,1],[87,9,87,53,1],[88,9,88,40,1],[88,41,88,67,0],[90,9,90,42,1],[92,9,92,97,1],[94,9,94,28,1],[95,9,95,10,1],[96,13,97,73,1],[97,73,97,86,1],[97,86,97,90,1],[98,13,98,43,1],[101,9,101,45,1],[102,9,102,50,1],[103,5,103,6,1],[121,5,121,6,1],[122,9,122,53,1],[123,9,123,40,1],[123,41,123,67,0],[125,9,125,42,1],[127,9,131,51,1],[133,9,133,28,1],[134,9,134,10,1],[135,13,136,69,1],[136,69,136,82,1],[136,82,136,86,1],[137,13,137,43,1],[140,9,140,45,1],[141,9,144,44,1],[145,5,145,6,1],[167,5,167,6,1],[168,9,168,21,1],[169,9,169,10,1],[170,13,170,128,1],[171,13,171,78,1],[174,9,174,53,1],[175,9,175,40,1],[175,41,175,67,0],[177,9,177,42,1],[179,9,184,51,1],[186,9,186,28,1],[187,9,187,10,1],[188,13,189,73,1],[189,73,189,86,1],[189,86,189,90,1],[190,13,190,43,1],[193,9,193,45,1],[194,9,194,50,1],[195,5,195,6,1],[211,5,211,6,1],[212,9,212,21,1],[213,9,213,10,1],[214,13,214,128,1],[215,13,215,78,1],[218,9,218,53,1],[219,9,219,40,1],[219,41,219,67,0],[221,9,221,42,1],[223,9,223,96,1],[225,9,225,28,1],[226,9,226,10,1],[227,13,228,73,1],[228,73,228,86,1],[228,86,228,90,1],[229,13,229,43,1],[232,9,232,28,1],[233,5,233,6,1]]);
    </script>
  </body>
</html>